<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>URLS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              input: "hsl(var(--input))",
              ring: "hsl(var(--ring))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: {
                DEFAULT: "hsl(var(--primary))",
                foreground: "hsl(var(--primary-foreground))",
              },
              secondary: {
                DEFAULT: "hsl(var(--secondary))",
                foreground: "hsl(var(--secondary-foreground))",
              },
              destructive: {
                DEFAULT: "hsl(var(--destructive))",
                foreground: "hsl(var(--destructive-foreground))",
              },
              muted: {
                DEFAULT: "hsl(var(--muted))",
                foreground: "hsl(var(--muted-foreground))",
              },
              accent: {
                DEFAULT: "hsl(var(--accent))",
                foreground: "hsl(var(--accent-foreground))",
              },
              popover: {
                DEFAULT: "hsl(var(--popover))",
                foreground: "hsl(var(--popover-foreground))",
              },
              card: {
                DEFAULT: "hsl(var(--card))",
                foreground: "hsl(var(--card-foreground))",
              },
            },
            borderRadius: {
              lg: "var(--radius)",
              md: "calc(var(--radius) - 2px)",
              sm: "calc(var(--radius) - 4px)",
            },
          },
        },
      };
    </script>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body class="min-h-full bg-background antialiased">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
      <div class="mb-8 flex items-start justify-between">
        <div>
          <h1 class="text-4xl font-bold tracking-tight mb-2 flex items-center">
            <span class="text-foreground">URL</span>
            <span class="h-8 w-px bg-secondary"></span>
            <span class="text-primary">S</span>
          </h1>
          <p class="text-muted-foreground">Create and manage your shortened URLs</p>
        </div>
        <div class="flex items-center space-x-4">
          <% if (owner) { %>
            <!-- Space Switcher -->
            <div class="relative">
              <button
                type="button"
                id="spaceBtn"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
                onclick="toggleSpaceDropdown()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                  <path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z"></path>
                  <path d="M3 9V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v4"></path>
                </svg>
                <%= activeSpace ? activeSpace.name : 'Select Space' %>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 opacity-50">
                  <path d="m6 9 6 6 6-6"></path>
                </svg>
              </button>
              <div
                id="spaceDropdown"
                class="absolute right-0 mt-2 w-56 rounded-lg border bg-card text-card-foreground shadow-lg z-50 hidden"
              >
                <div class="p-1">
                  <div class="px-2 py-1.5 text-xs font-semibold text-muted-foreground">Spaces</div>
                  <% spaces.forEach(space => { %>
                    <a
                      href="/?owner=<%= owner %>&space=<%= space._id %>"
                      class="relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground <%= activeSpace && activeSpace._id.toString() === space._id.toString() ? 'bg-accent/50' : '' %>"
                    >
                      <span class="truncate"><%= space.name %></span>
                      <% if (activeSpace && activeSpace._id.toString() === space._id.toString()) { %>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-auto">
                          <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                      <% } %>
                    </a>
                  <% }) %>
                  <div class="h-px bg-muted my-1"></div>
                  <button
                    onclick="showCreateSpaceDialog()"
                    class="relative flex w-full cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                      <path d="M5 12h14"></path>
                      <path d="M12 5v14"></path>
                    </svg>
                    Create Space
                  </button>
                </div>
              </div>
            </div>

            <!-- Owner Avatar -->
            <div class="relative">
              <button
                type="button"
                id="avatarBtn"
                class="relative flex items-center justify-center w-10 h-10 rounded-full bg-primary text-primary-foreground hover:bg-primary/90 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                onclick="toggleOwnerDropdown()"
                aria-label="Owner settings"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </button>
              <div
                id="ownerDropdown"
                class="absolute right-0 mt-2 w-80 rounded-lg border bg-card text-card-foreground shadow-lg z-50 hidden"
                onclick="event.stopPropagation()"
              >
                <div class="p-4 space-y-4">
                  <div>
                    <label for="ownerToken" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 mb-2 block">
                      Owner token
                    </label>
                    <div class="relative">
                      <input
                        type="text"
                        id="ownerToken"
                        value="<%= owner %>"
                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 pr-10 text-sm font-mono ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                        onblur="handleOwnerTokenChange(this)"
                        onkeydown="handleOwnerTokenKeydown(event, this)"
                      />
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none"
                      >
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                      </svg>
                    </div>
                    <p class="text-xs text-muted-foreground mt-2">Changing the token will reassign all your URLs to the new token.</p>
                  </div>
                  <% if (activeSpace) { %>
                    <div class="h-px bg-muted my-1"></div>
                    <div>
                      <h4 class="text-sm font-medium mb-2">Current Space: <%= activeSpace.name %></h4>
                      <p class="text-xs text-muted-foreground mb-4">Domain: <%= activeSpace.domain %></p>
                      <div class="flex space-x-2">
                        <button
                          type="button"
                          class="inline-flex items-center justify-center rounded-md text-xs font-medium border border-input bg-background hover:bg-accent h-8 px-3 flex-1"
                          onclick="showEditSpaceDialog('<%= activeSpace._id %>', '<%= activeSpace.name %>', '<%= activeSpace.domain %>')"
                        >
                          Edit Space
                        </button>
                        <button
                          type="button"
                          class="inline-flex items-center justify-center rounded-md text-xs font-medium bg-destructive text-destructive-foreground hover:bg-destructive/90 h-8 px-3"
                          onclick="confirmDeleteSpace('<%= activeSpace._id %>', '<%= activeSpace.name %>')"
                        >
                          Delete
                        </button>
                      </div>
                    </div>
                  <% } %>
                  <div class="h-px bg-muted my-1"></div>
                  <div>
                    <button
                      type="button"
                      id="copyLinkBtn"
                      class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3 w-full"
                      onclick="copyDashboardLink()"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2"></path></svg>
                      Copy dashboard link
                    </button>
                  </div>
                </div>
              </div>
            </div>
          <% } %>
        </div>
      </div>

      <div class="rounded-lg border border-input bg-card text-card-foreground shadow-sm p-6 mb-6">
        <form action="/shortUrls" method="POST">
          <input type="hidden" name="space" value="<%= activeSpace ? activeSpace._id : '' %>" />
          <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
            <div class="md:col-span-8">
              <label for="fullUrl" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 mb-2 block">
                URL
              </label>
              <input
                required
                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                type="url"
                placeholder="https://example.com"
                name="fullUrl"
                id="fullUrl"
              />
            </div>
            <div class="md:col-span-3">
              <label for="customSuffix" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 mb-2 block">
                Custom alias (optional)
              </label>
              <input
                name="customSuffix"
                id="customSuffix"
                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                placeholder="my-alias"
              />
            </div>
            <div class="md:col-span-1 flex items-end">
              <button
                type="submit"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 w-full"
              >
                Shorten
              </button>
            </div>
          </div>
        </form>
      </div>
      
      <% if (shortUrls.length === 0) { %>
        <div class="rounded-lg border border-input border-dashed bg-muted/50 p-12 text-center">
          <p class="text-muted-foreground">No URLs have been shortened yet.</p>
        </div>
      <% } else { %>
        <div class="rounded-lg border border-input bg-card text-card-foreground shadow-sm overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full caption-bottom text-sm">
              <thead class="[&_tr]:border-b">
                <tr class="border-b border-input transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground w-12">
                    <input
                      type="checkbox"
                      id="selectAll"
                      class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2"
                    />
                  </th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer hover:text-foreground group sortable" data-sort="full">
                    <div class="flex items-center">
                      URL
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-1 opacity-0 group-hover:opacity-100 transition-opacity w-3 h-3 sort-icon"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>
                    </div>
                  </th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer hover:text-foreground group sortable" data-sort="short">
                    <div class="flex items-center">
                      Short link
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-1 opacity-0 group-hover:opacity-100 transition-opacity w-3 h-3 sort-icon"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>
                    </div>
                  </th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer hover:text-foreground group sortable" data-sort="alias">
                    <div class="flex items-center">
                      Alias
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-1 opacity-0 group-hover:opacity-100 transition-opacity w-3 h-3 sort-icon"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>
                    </div>
                  </th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer hover:text-foreground group sortable" data-sort="clicks" data-type="number">
                    <div class="flex items-center">
                      Clicks
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-1 opacity-0 group-hover:opacity-100 transition-opacity w-3 h-3 sort-icon"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>
                    </div>
                  </th>
                  <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer hover:text-foreground group sortable" data-sort="createdAt" data-type="date">
                    <div class="flex items-center">
                      Created At
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-1 opacity-0 group-hover:opacity-100 transition-opacity w-3 h-3 sort-icon"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>
                    </div>
                  </th>
                  <th class="h-12 px-4 text-right align-middle font-medium text-muted-foreground w-24">Actions</th>
                </tr>
              </thead>
              <tbody class="[&_tr:last-child]:border-0">
                <% shortUrls.forEach(shortUrl => { %>
                  <tr class="border-b border-input transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                    <td class="p-4 align-middle">
                      <input
                        type="checkbox"
                        class="url-select h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2"
                        name="selected"
                        value="<%= shortUrl.short %>"
                      />
                    </td>
                    <td class="p-4 align-middle">
                      <div class="max-w-md truncate" title="<%= shortUrl.full %>">
                        <%= shortUrl.full %>
                      </div>
                    </td>
                    <td class="p-4 align-middle">
                      <div class="flex items-center">
                        <a
                          href="//<%= shortUrl.domain %>/<%= shortUrl.short %>"
                          class="text-primary hover:underline font-mono"
                          target="_blank"
                        >
                          <%= shortUrl.domain %>/<%= shortUrl.short %>
                        </a>
                        <button
                          type="button"
                          class="ml-2 text-muted-foreground hover:text-primary transition-colors"
                          title="Copy short link"
                          onclick="copyToClipboard(this, '<%= shortUrl.domain %>/<%= shortUrl.short %>')"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                            <path d="M4 16c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2"></path>
                          </svg>
                        </button>
                      </div>
                    </td>
                    <td class="p-4 align-middle">
                      <% if (shortUrl.alias && shortUrl.alias.length) { %>
                        <div class="flex flex-col space-y-1">
                          <% shortUrl.alias.forEach(alias => { %>
                            <div class="flex items-center">
                              <a
                                href="//<%= shortUrl.domain %>/<%= alias %>"
                                class="text-primary hover:underline font-mono"
                                target="_blank"
                              >
                                <%= alias %>
                              </a>
                              <button
                                type="button"
                                class="ml-2 text-muted-foreground hover:text-primary transition-colors"
                                title="Copy alias link"
                                onclick="copyToClipboard(this, '<%= shortUrl.domain %>/<%= alias %>')"
                              >
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                  <path d="M4 16c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2"></path>
                                </svg>
                              </button>
                            </div>
                          <% }) %>
                        </div>
                      <% } else { %>
                        <span class="text-muted-foreground">â€”</span>
                      <% } %>
                    </td>
                    <td class="p-4 align-middle" data-value="<%= shortUrl.clicks %>">
                      <span class="inline-flex items-center rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold">
                        <%= shortUrl.clicks %>
                      </span>
                    </td>
                    <td class="p-4 align-middle text-muted-foreground" data-value="<%= new Date(shortUrl.createdAt).getTime() %>">
                      <%= new Date(shortUrl.createdAt).toLocaleString() %>
                    </td>
                    <td class="p-4 align-middle text-right">
                      <div class="flex items-center justify-end space-x-2">
                        <button
                          type="button"
                          class="action-btn inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8 edit-url-btn"
                          title="Edit URL"
                          data-short="<%= shortUrl.short %>"
                          data-full="<%= shortUrl.full %>"
                          data-aliases="<%= shortUrl.alias.join(',') %>"
                          onclick="handleEditClick(this)"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                            <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
                            <path d="m15 5 4 4"></path>
                          </svg>
                        </button>
                        <form
                          action="/delete"
                          method="POST"
                          class="inline delete-form"
                          data-short="<%= shortUrl.short %>"
                        >
                          <input type="hidden" name="space" value="<%= activeSpace ? activeSpace._id : '' %>" />
                          <input type="hidden" name="short" value="<%= shortUrl.short %>" />
                          <button
                            type="button"
                            class="action-btn delete-btn inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-8 w-8"
                            title="Delete this URL"
                            onclick="handleDeleteClick(this)"
                          >
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                              <path d="M3 6h18"></path>
                              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                              <line x1="10" y1="11" x2="10" y2="17"></line>
                              <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                          </button>
                        </form>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
        <div class="mt-4 flex items-center justify-between">
          <button
            type="button"
            id="exportBtn"
            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4"
            onclick="exportUrls()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
            Export my URLs (JSON)
          </button>
          <div id="bulkDeleteContainer" style="display: none;">
            <button
              type="button"
              id="deleteSelected"
              class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-9 px-4"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 w-4 h-4">
                <path d="M3 6h18"></path>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
              Delete selected
            </button>
          </div>
        </div>
        <% } %>
    </div>

    <!-- Dialog Component -->
    <div id="dialog-overlay" class="fixed inset-0 z-50 bg-black/50 hidden items-center justify-center" onclick="closeDialog()">
      <div id="dialog-content" class="relative bg-card text-card-foreground rounded-lg border shadow-lg max-w-lg w-full mx-4 p-6" onclick="event.stopPropagation()">
        <div id="dialog-header" class="flex flex-col space-y-1.5 text-center sm:text-left mb-4">
          <h2 id="dialog-title" class="text-lg font-semibold leading-none tracking-tight"></h2>
          <p id="dialog-description" class="text-sm text-muted-foreground whitespace-pre-wrap"></p>
        </div>
        <div id="dialog-body" class="mb-4"></div>
        <div id="dialog-footer" class="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 space-y-2 space-y-reverse sm:space-y-0">
          <button
            id="dialog-cancel"
            type="button"
            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
          >
            Cancel
          </button>
          <button
            id="dialog-confirm"
            type="button"
            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Export Dialog Component -->
    <div id="export-dialog-overlay" class="fixed inset-0 z-50 bg-black/50 hidden items-center justify-center" onclick="closeExportDialog()">
      <div id="export-dialog-content" class="relative bg-card text-card-foreground rounded-lg border shadow-lg max-w-2xl w-full mx-4 p-6 max-h-[90vh] flex flex-col" onclick="event.stopPropagation()">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-lg font-semibold leading-none tracking-tight">Export URLs</h2>
            <p id="export-stats" class="text-sm text-muted-foreground mt-1"></p>
          </div>
          <button
            type="button"
            onclick="closeExportDialog()"
            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-8 w-8 rounded-md"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            <span class="sr-only">Close</span>
          </button>
        </div>
        <div id="export-body" class="flex-1 overflow-hidden flex flex-col">
          <div id="export-loading" class="flex items-center justify-center py-12">
            <div class="text-center">
              <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"></div>
              <p class="text-sm text-muted-foreground">Loading export data...</p>
            </div>
          </div>
          <div id="export-content" class="hidden flex-1 flex flex-col">
            <div class="mb-4 flex-1 min-h-0">
              <label class="text-sm font-medium mb-2 block">JSON Preview</label>
              <textarea
                id="export-json"
                readonly
                class="flex min-h-[200px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none overflow-auto"
              ></textarea>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 sm:justify-end">
              <button
                type="button"
                id="export-copy-btn"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
                onclick="copyExportToClipboard()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2"></path></svg>
                Copy to clipboard
              </button>
              <button
                type="button"
                id="export-download-btn"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
                onclick="downloadExport()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
                Download JSON
              </button>
            </div>
          </div>
          <div id="export-error" class="hidden">
            <div class="rounded-md bg-destructive/10 border border-destructive/20 p-4">
              <p class="text-sm text-destructive font-medium mb-1">Export failed</p>
              <p id="export-error-message" class="text-sm text-destructive/80"></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Initialize owner token and space data for JavaScript modules -->
    <script id="allowedDomainsData" type="application/json">
      <%- JSON.stringify(allowedDomains) %>
    </script>
    <script>
      window.currentOwnerToken = '<%= owner || "" %>';
      window.currentActiveSpaceId = '<%= activeSpace ? activeSpace._id : "" %>';
    </script>
    
    <!-- Load JavaScript modules in order -->
    <script src="/js/dialog.js"></script>
    <script src="/js/url-management.js"></script>
    <script src="/js/export.js"></script>
    <script src="/js/owner-token.js"></script>
    <script src="/js/space-management.js"></script>
  </body>
</html>
